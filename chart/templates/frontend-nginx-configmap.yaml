apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "login.frontend.fullname" . }}-nginx-config
  labels:
    {{- include "login.labels" . | nindent 4 }}
    app.kubernetes.io/component: frontend
data:
  default.conf: |
    server {
      listen 80;
      server_name _;
      root /usr/share/nginx/html;
      index index.html;

      # Enable gzip compression
      gzip on;
      gzip_types text/plain text/css application/json application/javascript text/xml application/xml text/javascript;

      # Redirect root to /app
      location = / {
        return 302 /app;
      }

      # SPA routing - serve index.html for all non-file requests
      location / {
        try_files $uri $uri/ /index.html;
      }

      # Cache static assets
      location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
      }
    }
